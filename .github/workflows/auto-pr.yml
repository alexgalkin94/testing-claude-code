name: Auto Create PR for Claude Branches

on:
  push:
    branches:
      - 'claude/**'

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create PR if not exists
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH_NAME: ${{ github.ref_name }}
        run: |
          # Check if PR already exists for this branch
          EXISTING_PR=$(gh pr list --head "$BRANCH_NAME" --json number --jq '.[0].number')

          if [ -z "$EXISTING_PR" ]; then
            echo "Creating new PR for branch $BRANCH_NAME"

            # Get the last commit message as PR title
            COMMIT_MSG=$(git log -1 --pretty=%s)

            # Create the PR
            gh pr create \
              --title "$COMMIT_MSG" \
              --body "Automatically created PR for branch \`$BRANCH_NAME\`

This PR was created automatically when the branch was pushed.

---
*Created by GitHub Actions*" \
              --base main \
              --head "$BRANCH_NAME"
          else
            echo "PR #$EXISTING_PR already exists for branch $BRANCH_NAME"
          fi
